<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.toyo.fish.data.wrapper.friends.persistence.FriendsMapper" >
  <resultMap id="BaseResultMap" type="com.toyo.fish.data.wrapper.friends.domain.Friends" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="user_id" property="userId" jdbcType="BIGINT" />
    <result column="last_access_time" property="lastAccessTime" jdbcType="TIMESTAMP" />
    <result column="max_friends" property="maxFriends" jdbcType="INTEGER" />
    <result column="current_friends" property="currentFriends" jdbcType="INTEGER" />
    <result column="max_friends_reuqest" property="maxFriendsReuqest" jdbcType="INTEGER" />
    <result column="current_friends_request" property="currentFriendsRequest" jdbcType="INTEGER" />
    <result column="max_give_vit" property="maxGiveVit" jdbcType="INTEGER" />
    <result column="current_give_vit" property="currentGiveVit" jdbcType="INTEGER" />
    <result column="max_get_vit" property="maxGetVit" jdbcType="INTEGER" />
    <result column="current_get_vit" property="currentGetVit" jdbcType="INTEGER" />
    <result column="last_refresh_recomment_friends" property="lastRefreshRecommentFriends" jdbcType="TIMESTAMP" />
    <result column="avatar" property="avatar" jdbcType="VARCHAR" />
    <result column="nick_name" property="nickName" jdbcType="VARCHAR" />
    <result column="user_level" property="userLevel" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, update_time, create_time, user_id, last_access_time, max_friends, current_friends, 
    max_friends_reuqest, current_friends_request, max_give_vit, current_give_vit, max_get_vit, 
    current_get_vit, last_refresh_recomment_friends, avatar, nick_name, user_level
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from ty_friends
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from ty_friends
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <delete id="deleteByUserId" >
    <!--
     delete by user_id
    -->
    delete from ty_friends
    where user_id = #{userId,jdbcType=BIGINT}
  </delete>
  
  
  <insert id="insert" parameterType="com.toyo.fish.data.wrapper.friends.domain.Friends" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ty_friends (id, update_time, create_time, 
      user_id, last_access_time, max_friends, 
      current_friends, max_friends_reuqest, current_friends_request, 
      max_give_vit, current_give_vit, max_get_vit, 
      current_get_vit, last_refresh_recomment_friends, 
      avatar, nick_name, user_level
      )
    values (#{id,jdbcType=BIGINT}, #{updateTime,jdbcType=TIMESTAMP}, #{createTime,jdbcType=TIMESTAMP}, 
      #{userId,jdbcType=BIGINT}, #{lastAccessTime,jdbcType=TIMESTAMP}, #{maxFriends,jdbcType=INTEGER}, 
      #{currentFriends,jdbcType=INTEGER}, #{maxFriendsReuqest,jdbcType=INTEGER}, #{currentFriendsRequest,jdbcType=INTEGER}, 
      #{maxGiveVit,jdbcType=INTEGER}, #{currentGiveVit,jdbcType=INTEGER}, #{maxGetVit,jdbcType=INTEGER}, 
      #{currentGetVit,jdbcType=INTEGER}, #{lastRefreshRecommentFriends,jdbcType=TIMESTAMP}, 
      #{avatar,jdbcType=VARCHAR}, #{nickName,jdbcType=VARCHAR}, #{userLevel,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.toyo.fish.data.wrapper.friends.domain.Friends" 
 	 useGeneratedKeys="true" keyProperty="id"
  >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ty_friends
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="updateTime != null" >
        update_time,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="userId != null" >
        user_id,
      </if>
      <if test="lastAccessTime != null" >
        last_access_time,
      </if>
      <if test="maxFriends != null" >
        max_friends,
      </if>
      <if test="currentFriends != null" >
        current_friends,
      </if>
      <if test="maxFriendsReuqest != null" >
        max_friends_reuqest,
      </if>
      <if test="currentFriendsRequest != null" >
        current_friends_request,
      </if>
      <if test="maxGiveVit != null" >
        max_give_vit,
      </if>
      <if test="currentGiveVit != null" >
        current_give_vit,
      </if>
      <if test="maxGetVit != null" >
        max_get_vit,
      </if>
      <if test="currentGetVit != null" >
        current_get_vit,
      </if>
      <if test="lastRefreshRecommentFriends != null" >
        last_refresh_recomment_friends,
      </if>
      <if test="avatar != null" >
        avatar,
      </if>
      <if test="nickName != null" >
        nick_name,
      </if>
      <if test="userLevel != null" >
        user_level,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=BIGINT},
      </if>
      <if test="lastAccessTime != null" >
        #{lastAccessTime,jdbcType=TIMESTAMP},
      </if>
      <if test="maxFriends != null" >
        #{maxFriends,jdbcType=INTEGER},
      </if>
      <if test="currentFriends != null" >
        #{currentFriends,jdbcType=INTEGER},
      </if>
      <if test="maxFriendsReuqest != null" >
        #{maxFriendsReuqest,jdbcType=INTEGER},
      </if>
      <if test="currentFriendsRequest != null" >
        #{currentFriendsRequest,jdbcType=INTEGER},
      </if>
      <if test="maxGiveVit != null" >
        #{maxGiveVit,jdbcType=INTEGER},
      </if>
      <if test="currentGiveVit != null" >
        #{currentGiveVit,jdbcType=INTEGER},
      </if>
      <if test="maxGetVit != null" >
        #{maxGetVit,jdbcType=INTEGER},
      </if>
      <if test="currentGetVit != null" >
        #{currentGetVit,jdbcType=INTEGER},
      </if>
      <if test="lastRefreshRecommentFriends != null" >
        #{lastRefreshRecommentFriends,jdbcType=TIMESTAMP},
      </if>
      <if test="avatar != null" >
        #{avatar,jdbcType=VARCHAR},
      </if>
      <if test="nickName != null" >
        #{nickName,jdbcType=VARCHAR},
      </if>
      <if test="userLevel != null" >
        #{userLevel,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.toyo.fish.data.wrapper.friends.domain.Friends" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ty_friends
    <set >
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="userId != null" >
        user_id = #{userId,jdbcType=BIGINT},
      </if>
      <if test="lastAccessTime != null" >
        last_access_time = #{lastAccessTime,jdbcType=TIMESTAMP},
      </if>
      <if test="maxFriends != null" >
        max_friends = #{maxFriends,jdbcType=INTEGER},
      </if>
      <if test="currentFriends != null" >
        current_friends = #{currentFriends,jdbcType=INTEGER},
      </if>
      <if test="maxFriendsReuqest != null" >
        max_friends_reuqest = #{maxFriendsReuqest,jdbcType=INTEGER},
      </if>
      <if test="currentFriendsRequest != null" >
        current_friends_request = #{currentFriendsRequest,jdbcType=INTEGER},
      </if>
      <if test="maxGiveVit != null" >
        max_give_vit = #{maxGiveVit,jdbcType=INTEGER},
      </if>
      <if test="currentGiveVit != null" >
        current_give_vit = #{currentGiveVit,jdbcType=INTEGER},
      </if>
      <if test="maxGetVit != null" >
        max_get_vit = #{maxGetVit,jdbcType=INTEGER},
      </if>
      <if test="currentGetVit != null" >
        current_get_vit = #{currentGetVit,jdbcType=INTEGER},
      </if>
      <if test="lastRefreshRecommentFriends != null" >
        last_refresh_recomment_friends = #{lastRefreshRecommentFriends,jdbcType=TIMESTAMP},
      </if>
      <if test="avatar != null" >
        avatar = #{avatar,jdbcType=VARCHAR},
      </if>
      <if test="nickName != null" >
        nick_name = #{nickName,jdbcType=VARCHAR},
      </if>
      <if test="userLevel != null" >
        user_level = #{userLevel,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.toyo.fish.data.wrapper.friends.domain.Friends" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ty_friends
    set update_time = #{updateTime,jdbcType=TIMESTAMP},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      user_id = #{userId,jdbcType=BIGINT},
      last_access_time = #{lastAccessTime,jdbcType=TIMESTAMP},
      max_friends = #{maxFriends,jdbcType=INTEGER},
      current_friends = #{currentFriends,jdbcType=INTEGER},
      max_friends_reuqest = #{maxFriendsReuqest,jdbcType=INTEGER},
      current_friends_request = #{currentFriendsRequest,jdbcType=INTEGER},
      max_give_vit = #{maxGiveVit,jdbcType=INTEGER},
      current_give_vit = #{currentGiveVit,jdbcType=INTEGER},
      max_get_vit = #{maxGetVit,jdbcType=INTEGER},
      current_get_vit = #{currentGetVit,jdbcType=INTEGER},
      last_refresh_recomment_friends = #{lastRefreshRecommentFriends,jdbcType=TIMESTAMP},
      avatar = #{avatar,jdbcType=VARCHAR},
      nick_name = #{nickName,jdbcType=VARCHAR},
      user_level = #{userLevel,jdbcType=INTEGER}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  
  <update id="updateByUserId"  >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ty_friends
    <set >
     
     
      <if test="friends != null" >
        current_friends = current_friends+#{friends,jdbcType=INTEGER},
      </if>
     
      <if test="friendsRequest != null" >
        current_friends_request = current_friends_request+#{friendsRequest,jdbcType=INTEGER},
      </if>
     
      <if test="giveVit != null" >
        current_give_vit = current_give_vit+#{giveVit,jdbcType=INTEGER},
      </if>
    
      <if test="getVit != null" >
        current_get_vit =current_get_vit+ #{getVit,jdbcType=INTEGER},
      </if>
     
    
    </set>
    where user_id = #{userId,jdbcType=BIGINT}
     
  </update>
   <update id="updateByUserIds"  >
   
    update ty_friends
    <set >
     
     
      <if test="friends != null" >
        current_friends = current_friends+#{friends,jdbcType=INTEGER},
      </if>
     
      <if test="friendsRequest != null" >
        current_friends_request = current_friends_request+#{friendsRequest,jdbcType=INTEGER},
      </if>
     
      <if test="giveVit != null" >
        current_give_vit = current_give_vit+#{giveVit,jdbcType=INTEGER},
      </if>
    
      <if test="getVit != null" >
        current_get_vit =current_get_vit+ #{getVit,jdbcType=INTEGER},
      </if>
     
    
    </set>
    where
    
     <if test="userIdSeq == null" >
     1=2
     </if>
     <if test="userIdSeq != null" >
    	     user_id  in 
    <foreach  item="item" collection="userIdSeq" open="(" close=")" index="index" separator=",">
    	${item}
    </foreach>
    </if>
  
     
  </update>
  
  
   <select id="selectByUserId" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from ty_friends
    where user_id = #{id,jdbcType=BIGINT} 
  </select>
  
  <update id="updateFriendsRestrictions" >
  	update ty_friends
    set 
   	  current_friends_request = 0,
      current_give_vit =0,
      current_get_vit =0 
     
 </update>
 
 
  <select id="sizeOfRecommentFriends" resultType="java.lang.Integer" >
    
    select 
   	count(1) as cnt
    from ty_friends
    where user_id !=#{userId} and user_id not in (select friend_user_id from ty_friends_relation where owner_user_id=${userId})
  
  </select>
 
  
  <select id="getRecommentFriends" resultMap="BaseResultMap" >
    
    select 
    <include refid="Base_Column_List" />
    from ty_friends
    
    order by  last_access_time desc limit 0,1000
  </select>
  
  
</mapper>